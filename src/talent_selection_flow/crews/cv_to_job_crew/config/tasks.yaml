# YAML-first task definitions
identify_gaps_task:
  description: >
    Using the following inputs:
    - Candidate CV: {structured_cv}
    - Matched Jobs Dictionary: {related_jobs}

    Instructions:
    1. The `Matched Jobs Dictionary` contains top matches where the key is the Job ID.
    2. For each Job ID, compare the `skills`, `industries`, `experience_level`, and `summary` against the Candidate's CV.
    3. Identify specific "Gaps"—missing technologies, years of experience, or industry exposure.
    4. Do not hallucinate skills; if the CV doesn't explicitly mention a skill required in the `summary`, mark it as a potential gap.

  expected_output: >
    For each job_id, identify:
      - matched_skills: skills that appear both in the job requirements and are clearly evidenced in the candidate CV
      - missing_must_have: required "must-have" skills/experiences not evidenced in the candidate CV

    The output must organize results per job_id and follow a strict JSON structure:
    {
      "jobs": {
        "JOB_ID": {
          "matched_skills": ["skill1", "skill2"],
          "missing_must_have": ["req1", "req2"],
        }
      }
    }
    Additional rules:
    - Only return the JSON — no commentary before or after.

generate_interview_questions_task:
  description: >
    Using:
    - Context

    For each analyzed job, generate 5-10 interview questions.
    Include:
    - Questions validating matched skills (1-3)
    - Questions probing must-have gaps (2-4)
    - Questions clarifying ambiguities (1-3)
    - Questions assessing seniority alignment (1-2)

  expected_output: >
    Return a strict JSON object with the following structure:
    {
      "jobs": {
        "JOB_ID": {
          "matched_skill_questions": [
            {"question": "...", "response": "..."}
          ],
          "gap_probing_questions": [
            {"question": "...", "response": "..."}
          ],
          "ambiguity_clarification_questions": [
            {"question": "...", "response": "..."}
          ],
          "seniority_questions": [
            {"question": "...", "response": "..."}
          ],
        }
      }
    }
    Additional rules:
    - Every question must have a short correct response.
    - Only return the JSON — no commentary before or after.

write_report_task:
  description: >
    Using:
    - Candidate CV: {structured_cv}
    - Matched Jobs Dictionary: {related_jobs}
    - Context:
      - Gap analyses JSON (identify_gaps_task output)
      - Interview questions JSON (generate_interview_questions_task output)

    Create a polished Markdown report combining:
    - Top matches (ranked)
    - Score explanations
    - Skill gaps
    - Interview questions per match
    - Overall recommendation and caveats

    Formatting:
    - Use clear headings
    - Provide a short executive summary
    - Keep it HR-friendly but technically accurate
  expected_output: >
    A complete Markdown report as a single string.
